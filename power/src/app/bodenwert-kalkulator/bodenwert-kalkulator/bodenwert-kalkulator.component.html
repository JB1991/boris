<div class="container-fluid p-0 m-0">
    <div class="row m-0">
        <div id="mapWrapper"
             [class]="isCollapsed ? 'col-12 map-collapsed' : 'col-lg-6 map'">
            <div class="wrapper"
                 #map>
                <!-- desktop -->
                <div [class]="isCollapsed ? 'd-none d-md-block' : 'd-none d-xl-block'">
                    <div class="nav-scroller bg-white shadow-sm border-top">
                        <nav class="nav nav-underline d-flex justify-content-between">
                            <div class="nav">
                                <div class="btn-group d-flex">
                                </div>
                            </div>
                            <div class="nav px-auto"
                                 style="position: relative;">
                                <power-geosearch [(resetGeosearch)]="resetGeosearch"
                                                 (selectResult)="flyTo($event)"></power-geosearch>
                                <!-- <button class="nav-link btn"
                                        type="button"
                                        (click)="selectingFlurstueck()"
                                        alt="Flurstück aus- bzw abwählen"
                                        title="Flurstück aus- bzw abwählen"
                                        i18n-alt
                                        i18n-title>
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-flag"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                              d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21.294 21.294 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21.317 21.317 0 0 0 14 7.655V1.222z" />
                                    </svg>
                                </button> -->
                            </div>
                            <div class="nav">
                                <button class="nav-link btn"
                                        type="button"
                                        (click)="resetSelection()"
                                        title="Selektion zurücksetzen"
                                        alt="Selektion zurücksetzen"
                                        i18n-alt
                                        i18n-title>
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-trash"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path
                                              d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                                        <path fill-rule="evenodd"
                                              d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
                                    </svg>
                                </button>
                                <button class="nav-link btn"
                                        type="button"
                                        (click)="toggleLocationTracking()"
                                        [ngClass]="{'active': searchActive}"
                                        alt="Eigenen Standort anzeigen"
                                        title="Eigenen Standort anzeigen"
                                        i18n-title
                                        i18n-alt>
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-geo-fill"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                              d="M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.319 1.319 0 0 0-.37.265.301.301 0 0 0-.057.09V14l.002.008a.147.147 0 0 0 .016.033.617.617 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.619.619 0 0 0 .146-.15.148.148 0 0 0 .015-.033L12 14v-.004a.301.301 0 0 0-.057-.09 1.318 1.318 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465-1.281 0-2.462-.172-3.34-.465-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411z" />
                                    </svg>
                                </button>
                                <button class="nav-link btn"
                                        type="button"
                                        [ngClass]="{'active': threeDActive}"
                                        alt="3D aktivieren/deaktivieren"
                                        title="3D aktivieren/deaktivieren"
                                        (click)="toggle3dView()"
                                        i18n-title
                                        i18n-alt>
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-building"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                              d="M14.763.075A.5.5 0 0 1 15 .5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V14h-1v1.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V10a.5.5 0 0 1 .342-.474L6 7.64V4.5a.5.5 0 0 1 .276-.447l8-4a.5.5 0 0 1 .487.022zM6 8.694L1 10.36V15h5V8.694zM7 15h2v-1.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5V15h2V1.309l-7 3.5V15z" />
                                        <path
                                              d="M2 11h1v1H2v-1zm2 0h1v1H4v-1zm-2 2h1v1H2v-1zm2 0h1v1H4v-1zm4-4h1v1H8V9zm2 0h1v1h-1V9zm-2 2h1v1H8v-1zm2 0h1v1h-1v-1zm2-2h1v1h-1V9zm0 2h1v1h-1v-1zM8 7h1v1H8V7zm2 0h1v1h-1V7zm2 0h1v1h-1V7zM8 5h1v1H8V5zm2 0h1v1h-1V5zm2 0h1v1h-1V5zm0-2h1v1h-1V3z" />
                                    </svg>
                                </button>
                                <button class="nav-link btn"
                                        type="button"
                                        title="Karte zurücksetzen"
                                        alt="Karte zurücksetzen"
                                        (click)="resetMap()"
                                        i18n-title
                                        i18n-alt>
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-globe"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                              d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4H2.255a7.025 7.025 0 0 1 3.072-2.472 6.7 6.7 0 0 0-.597.933c-.247.464-.462.98-.64 1.539zm-.582 3.5h-2.49c.062-.89.291-1.733.656-2.5H3.82a13.652 13.652 0 0 0-.312 2.5zM4.847 5H7.5v2.5H4.51A12.5 12.5 0 0 1 4.846 5zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5H7.5V11H4.847a12.5 12.5 0 0 1-.338-2.5zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12H7.5v2.923c-.67-.204-1.335-.82-1.887-1.855A7.97 7.97 0 0 1 5.145 12zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11H1.674a6.958 6.958 0 0 1-.656-2.5h2.49c.03.877.138 1.718.312 2.5zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12h2.355a7.967 7.967 0 0 1-.468 1.068c-.552 1.035-1.218 1.65-1.887 1.855V12zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5h-2.49A13.65 13.65 0 0 0 12.18 5h2.146c.365.767.594 1.61.656 2.5zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4H8.5V1.077c.67.204 1.335.82 1.887 1.855.173.324.33.682.468 1.068z" />
                                    </svg>
                                </button>
                            </div>
                        </nav>
                    </div>
                </div>

                <!-- mobile -->
                <div [class]="isCollapsed ? 'd-md-none' : 'd-xl-none'">
                    <div class="nav-scroller bg-white shadow-sm border-top">
                        <nav class="nav nav-underline">
                            <div class="nav ml-auto">
                                <button class="nav-link btn"
                                        type="button"
                                        title="Suche"
                                        alt="Suche"
                                        i18n-alt
                                        i18n-title
                                        (click)="toggleSearchActive()"
                                        [ngClass]="{'active': searchActive}">
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-search"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                              d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z" />
                                        <path fill-rule="evenodd"
                                              d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z" />
                                    </svg>
                                </button>
                                <button class="nav-link btn"
                                        (click)="resetSelection()"
                                        title="Selektion zurücksetzen"
                                        alt="Selektion zurücksetzen"
                                        i18n-alt
                                        i18n-title>
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-trash"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path
                                              d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                                        <path fill-rule="evenodd"
                                              d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
                                    </svg>
                                </button>
                                <button class="nav-link btn"
                                        type="button"
                                        (click)="enableLocationTracking()"
                                        [ngClass]="{'active': locationTrackingActive}"
                                        alt="Eigenen Standort anzeigen"
                                        title="Eigenen Standort anzeigen"
                                        i18n-title
                                        i18n-alt>
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-geo-fill"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                              d="M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.319 1.319 0 0 0-.37.265.301.301 0 0 0-.057.09V14l.002.008a.147.147 0 0 0 .016.033.617.617 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.619.619 0 0 0 .146-.15.148.148 0 0 0 .015-.033L12 14v-.004a.301.301 0 0 0-.057-.09 1.318 1.318 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465-1.281 0-2.462-.172-3.34-.465-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411z" />
                                    </svg>
                                </button>
                                <button class="nav-link btn"
                                        type="button"
                                        (click)="toggle3dView()"
                                        [ngClass]="{'active': threeDActive}"
                                        alt="3D aktivieren/deaktivieren"
                                        title="3D aktivieren/deaktivieren"
                                        i18n-title
                                        i18n-alt>
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-building"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                              d="M14.763.075A.5.5 0 0 1 15 .5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V14h-1v1.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V10a.5.5 0 0 1 .342-.474L6 7.64V4.5a.5.5 0 0 1 .276-.447l8-4a.5.5 0 0 1 .487.022zM6 8.694L1 10.36V15h5V8.694zM7 15h2v-1.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5V15h2V1.309l-7 3.5V15z" />
                                        <path
                                              d="M2 11h1v1H2v-1zm2 0h1v1H4v-1zm-2 2h1v1H2v-1zm2 0h1v1H4v-1zm4-4h1v1H8V9zm2 0h1v1h-1V9zm-2 2h1v1H8v-1zm2 0h1v1h-1v-1zm2-2h1v1h-1V9zm0 2h1v1h-1v-1zM8 7h1v1H8V7zm2 0h1v1h-1V7zm2 0h1v1h-1V7zM8 5h1v1H8V5zm2 0h1v1h-1V5zm2 0h1v1h-1V5zm0-2h1v1h-1V3z" />
                                    </svg>
                                </button>
                                <button class="nav-link btn"
                                        type="button"
                                        title="Karte zurücksetzen"
                                        alt="Karte zurücksetzen"
                                        (click)="resetMap()"
                                        i18n-title
                                        i18n-alt>
                                    <svg width="20px"
                                         height="20px"
                                         viewBox="0 0 16 16"
                                         class="bi bi-globe"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                              d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4H2.255a7.025 7.025 0 0 1 3.072-2.472 6.7 6.7 0 0 0-.597.933c-.247.464-.462.98-.64 1.539zm-.582 3.5h-2.49c.062-.89.291-1.733.656-2.5H3.82a13.652 13.652 0 0 0-.312 2.5zM4.847 5H7.5v2.5H4.51A12.5 12.5 0 0 1 4.846 5zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5H7.5V11H4.847a12.5 12.5 0 0 1-.338-2.5zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12H7.5v2.923c-.67-.204-1.335-.82-1.887-1.855A7.97 7.97 0 0 1 5.145 12zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11H1.674a6.958 6.958 0 0 1-.656-2.5h2.49c.03.877.138 1.718.312 2.5zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12h2.355a7.967 7.967 0 0 1-.468 1.068c-.552 1.035-1.218 1.65-1.887 1.855V12zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5h-2.49A13.65 13.65 0 0 0 12.18 5h2.146c.365.767.594 1.61.656 2.5zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4H8.5V1.077c.67.204 1.335.82 1.887 1.855.173.324.33.682.468 1.068z" />
                                    </svg>
                                </button>
                            </div>
                        </nav>
                    </div>
                </div>

                <power-geosearch [class.d-none]="!searchActive"
                                 [(resetGeosearch)]="resetGeosearch"
                                 (selectResult)="flyTo($event)"></power-geosearch>


                <div class="corner-ribbon top-left sticky shadow"
                     i18n>Testdaten</div>

                <mgl-map id="map"
                         (click)="onMapClickEvent($event)"
                         (load)="loadMap($event)"
                         [bounds]="bounds"
                         [maxZoom]="20"
                         [minZoom]="5"
                         [style]="MAP_STYLE_URL"
                         [trackResize]="true">

                    <mgl-vector-source id="geoserver"
                                       [tiles]="[ baseUrl +'/geoserver/gwc/service/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&LAYER=alkis:ax_flurstueck&STYLE=&TILEMATRIX=EPSG:900913:{z}&TILEMATRIXSET=EPSG:900913&FORMAT=application/vnd.mapbox-vector-tile&TILECOL={x}&TILEROW={y}']">
                    </mgl-vector-source>

                    <mgl-layer id="flurstuecke"
                               type="line"
                               [source]="'geoserver'"
                               [sourceLayer]="'ax_flurstueck'"
                               [paint]="{
      'line-color': '#c4153a',
      'line-width': {
        'stops': [[14,0],[16,1],[18,2]]
      },
      'line-opacity': {
        'stops' : [[14,0],[15,1]]
      }
    }"></mgl-layer>

                    <mgl-layer id="flurstuecke-fill"
                               type="fill"
                               [source]="'geoserver'"
                               [sourceLayer]="'ax_flurstueck'"
                               [paint]="{
      'fill-color': 'rgba(255,255,255,0)'
    }"></mgl-layer>

                    <mgl-layer id="flurstuecke-highlighted"
                               type="fill"
                               [source]="'geoserver'"
                               [sourceLayer]="'ax_flurstueck'"
                               [filter]="['in', '', '']"
                               [paint]="{
      'fill-color': 'rgba(255,0,0,0.4)',
      'fill-opacity': {
        'stops' : [[14,0],[15,1]]
    }
    }"></mgl-layer>
                </mgl-map>
            </div>
        </div>
        <div [class]="isCollapsed ? 'col-12' : 'col-lg-6 height-lg'">
            <div class="row">
                <div *ngIf="flurstueckSelection.size === 0"
                     class="text-center border-top col-12 p-0">
                    <h5 class="m-3 mx-center"
                        i18n>Wählen Sie Flurstücke auf der Karte aus</h5>
                </div>
                <div *ngIf="flurstueckSelection.size >= 1"
                     class="text-center border-top col-12 p-0">
                    <button type="button"
                            class="btn btn-collapse border col-12"
                            (click)="isCollapsed = !isCollapsed"
                            [attr.aria-expanded]="!isCollapsed"
                            aria-controls="collapseBasic">
                        <span i18n>Flurstücksauswahl</span>
                        <img src="{{ isCollapsed ? '/assets/icons/chevron-up.svg' : '/assets/icons/chevron-down.svg'}}"
                             width="25"
                             height="25"
                             alt="Einklappen/ausklappen"
                             i18n-alt>
                    </button>
                </div>
            </div>
            <div class="row overflow-auto"
                 [class]="isCollapsed ? '' : 'selection'">
                <div #collapse
                     id="collapseBasic"
                     class="p-0 col-12"
                     [collapse]="isCollapsed"
                     (expanded)="onExpanded()"
                     (collapsed)="onCollapsed()"
                     [isAnimated]="true">
                    <div class="well well-lg card card-block card-header">
                        <table class="table table-bordered">
                            <caption class="sr-only"
                                     i18n>Flurstücksdaten</caption>
                            <tbody>
                                <tr>
                                    <th scope="col"
                                        i18n>Amtliche Fläche</th>
                                    <th scope="col"
                                        i18n>Wert</th>
                                </tr>
                                <tr *ngFor="let feature of this.flurstueckSelection | keyvalue">
                                    <td>{{feature.value.properties.amtlicheflaeche | number }} m&#178;</td>
                                    <td>{{feature.value.properties.wert | currency:'EUR':"symbol" : '1.2-2'}}</td>
                                </tr>
                            </tbody>
                        </table>

                        <h3>
                            <span i18n>Summe</span>:
                            {{ flurstueckSelection | keyvalue | flurstueckPipe | currency:'EUR':"symbol" : '1.2-2'}}
                        </h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
