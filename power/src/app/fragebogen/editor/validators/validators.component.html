<div *ngFor="let item of struct; index as i">
    <div class="form-row m-0 mb-2">
        <div class="form-group col-3 m-0 pl-0">
            <label for="validatorType{{ i }}{{ uniqId }}"
                   class="sr-only"
                   i18n>Typ*</label>
            <select class="custom-select"
                    [(ngModel)]="item.type"
                    (change)="switchType($event, i); modelChanged($event)"
                    [class.is-invalid]="!item.type"
                    id="validatorType{{ i }}{{ uniqId }}"
                    name="validatorType{{ i }}{{ uniqId }}"
                    required>
                <option value="numeric"
                        i18n>Numerisch</option>
                <option value="text"
                        i18n>Text</option>
                <option value="regex"
                        i18n>Regex</option>
                <option value="expression"
                        i18n>Bedingung</option>
            </select>
        </div>

        <div class="form-group col-4 m-0"
             *ngIf="item.type === 'numeric' || item.type === 'text'">
            <label for="validatorMin{{ i }}{{ uniqId }}"
                   class="sr-only"
                   i18n>Minimaler Wert/Länge*</label>
            <input type="number"
                   class="form-control"
                   [(ngModel)]="item.min"
                   (change)="modelChanged($event)"
                   [class.is-invalid]="!item.min && item.min !== 0 || item.min < 0"
                   id="validatorMin{{ i }}{{ uniqId }}"
                   name="validatorMin{{ i }}{{ uniqId }}"
                   i18n-placeholder
                   placeholder="Minimaler Wert/Länge"
                   min="0"
                   max="10000"
                   required>
        </div>

        <div class="form-group col-4 m-0 pr-0"
             *ngIf="item.type === 'numeric' || item.type === 'text'">
            <label for="validatorMax{{ i }}{{ uniqId }}"
                   class="sr-only"
                   i18n>Maximaler Wert/Länge*</label>
            <input type="number"
                   class="form-control"
                   [(ngModel)]="item.max"
                   (change)="modelChanged($event)"
                   [class.is-invalid]="!item.max && item.max !== 0 || item.max < 0 || item.min > item.max"
                   id="validatorMax{{ i }}{{ uniqId }}"
                   name="validatorMax{{ i }}{{ uniqId }}"
                   i18n-placeholder
                   placeholder="Maximaler Wert/Länge"
                   min="0"
                   max="10000"
                   required>
        </div>

        <div class="form-group col-9 m-0 pr-0"
             *ngIf="item.type === 'regex'">
            <label for="validatorData{{ i }}{{ uniqId }}"
                   class="sr-only"
                   i18n>Regulärerausdruck*</label>
            <input type="text"
                   class="form-control"
                   [(ngModel)]="item.regex"
                   (change)="modelChanged($event)"
                   [class.is-invalid]="!item.regex"
                   id="validatorData{{ i }}{{ uniqId }}"
                   name="validatorData{{ i }}{{ uniqId }}"
                   i18n-placeholder
                   placeholder="Regulärerausdruck z.B.: ^\d*$"
                   maxlength="200"
                   required>
        </div>


        <div class="form-group col-4 m-0"
             *ngIf="item.type === 'expression'">
            <label for="validatorExpQuestion{{ i }}{{ uniqId }}"
                   class="sr-only"
                   i18n>Formularfeld*</label>
            <input type="text"
                   class="form-control"
                   [attr.list]="'conditionlist-' + uniqId"
                   [(ngModel)]="item.question"
                   (change)="modelChanged($event)"
                   [class.is-invalid]="!item.question"
                   id="validatorExpQuestion{{ i }}{{ uniqId }}"
                   name="validatorExpQuestion{{ i }}{{ uniqId }}"
                   i18n-placeholder
                   placeholder="Wert oder Variabel {e1}"
                   maxlength="200"
                   required>
        </div>

        <div class="form-group col-2 m-0"
             *ngIf="item.type === 'expression'">
            <label for="validatorExpOperator{{ i }}{{ uniqId }}"
                   class="sr-only"
                   i18n>Operator*</label>
            <select class="custom-select"
                    [(ngModel)]="item.operator"
                    (change)="switchValueType($event, i); modelChanged($event)"
                    [class.is-invalid]="!item.operator"
                    id="validatorExpOperator{{ i }}{{ uniqId }}"
                    name="validatorExpOperator{{ i }}{{ uniqId }}"
                    required>
                <option value="empty"
                        i18n>Leer</option>
                <option value="notempty"
                        i18n>Nicht leer</option>
                <option value="contains"
                        i18n>Enthält</option>
                <option value="notcontains"
                        i18n>Enthält nicht</option>
                <option value="equal">=</option>
                <option value="notequal">&lt;&gt;</option>
                <option value="greater">&gt;</option>
                <option value="less">&lt;</option>
                <option value="greaterorequal">&gt;=</option>
                <option value="lessorequal">&lt;=</option>
                <option value="anyof"
                        *ngIf="item.choices"
                        i18n>Enthält mindestens eines</option>
                <option value="allof"
                        *ngIf="item.choices"
                        i18n>Enthält alle</option>
            </select>
        </div>

        <div class="form-group col-3 m-0 pr-0"
             *ngIf="item.type === 'expression' && !(item.operator === 'empty' || item.operator === 'notempty')">
            <label for="validatorExpValueA{{ i }}{{ uniqId }}"
                   class="sr-only"
                   i18n>Wert oder Variabel %7Be1%7D</label>
            <input type="text"
                   class="form-control"
                   [attr.list]="'conditionlist-' + uniqId"
                   [(ngModel)]="item.value"
                   (change)="modelChanged($event)"
                   *ngIf="!(item.operator === 'anyof' || item.operator === 'allof')"
                   [class.is-invalid]="!item.value"
                   id="validatorExpValueA{{ i }}{{ uniqId }}"
                   name="validatorExpValueA{{ i }}{{ uniqId }}"
                   i18n-placeholder
                   placeholder="Wert oder Variabel {e1}"
                   maxlength="200"
                   required>

            <select multiple
                    class="custom-select"
                    *ngIf="item.operator === 'anyof' || item.operator === 'allof'"
                    [class.is-invalid]="!item.value"
                    id="validatorExpValueB{{ i }}{{ uniqId }}"
                    name="validatorExpValueB{{ i }}{{ uniqId }}"
                    required>
                <option *ngFor="let choice of item.choices; index as j"
                        (click)="selectedItems($event, i, j)"
                        value="{{ choice.value }}"
                        [selected]="item.value.indexOf(choice.value) !== -1">
                    {{ choice.text.default ? choice.text.default : choice.value }}
                </option>
            </select>
        </div>
    </div>
</div>

<datalist id="{{ 'conditionlist-' + uniqId }}">
    <option *ngFor="let question of questions; index as j"
            value="{{ '&#123;' + question.name + '&#125;' }}">
        {{ question.title }}
    </option>
    <option *ngFor="let variable of model.calculatedValues; index as j"
            value="{{ '&#123;' + variable.name + '&#125;' }}"></option>
    <option value="{item}"></option>
    <option value="{pageno}"></option>
    <option value="{pagecount}"></option>
    <option value="{locale}"></option>
    <option value="{correctedanswers}"></option>
    <option value="{incorrectedanswers}"></option>
    <option value="{questioncount}"></option>
</datalist>

<div class="mb-2">
    <button type="button"
            class="btn btn-danger btn-sm mr-2"
            i18n-title
            title="Validator entfernen"
            (click)="ValidatorDel()">
        <svg width="1em"
             height="1em"
             viewBox="0 0 16 16"
             class="bi bi-dash align-baseline"
             fill="currentColor"
             xmlns="http://www.w3.org/2000/svg"
             focusable="false"
             aria-hidden="true">
            <path fill-rule="evenodd"
                  d="M3.5 8a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.5-.5z" />
        </svg>
        <span class="sr-only"
              i18n>Validator entfernen</span>
    </button>
    <button type="button"
            class="btn btn-success btn-sm"
            i18n-title
            title="Validator hinzufügen"
            (click)="ValidatorAdd()">
        <svg width="1em"
             height="1em"
             viewBox="0 0 16 16"
             class="bi bi-plus align-baseline"
             fill="currentColor"
             xmlns="http://www.w3.org/2000/svg"
             focusable="false"
             aria-hidden="true">
            <path fill-rule="evenodd"
                  d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z" />
            <path fill-rule="evenodd"
                  d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z" />
        </svg>
        <span class="sr-only"
              i18n>Validator hinzufügen</span>
    </button>
</div>

<hr>

<div class="form-group row m-0 mb-3">
    <label for="validatorDefault"
           class="col-12 col-lg-4 col-form-label px-0"
           i18n>Standard Validator hinzufügen</label>
    <div class="col-12 col-lg-8 p-0">
        <select class="custom-select"
                (change)="selectDefaultValidator($event)"
                name="validatorDefault"
                required>
            <option value=""
                    selected
                    disabled
                    i18n>Validator Auswählen</option>
            <option value="date2"
                    i18n>Datum (yyyy-mm-dd)</option>
            <option value="date1"
                    i18n>Datum (dd.mm.yyyy)</option>
        </select>
    </div>
</div>
