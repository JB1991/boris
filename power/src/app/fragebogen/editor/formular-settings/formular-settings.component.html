<power-modal #formsettingsmodal
             [checkInvalid]="true"
             (closing)="close($event)">
    <div class="container px-1 px-lg-3"
         *ngIf="model">
        <accordion [isAnimated]="false"
                   [closeOthers]="true">
            <!-- common -->
            <accordion-group i18n-heading
                             heading="Allgemein"
                             class="mb-1 mb-lg-3">
                <!-- form-title -->
                <div class="form-group">
                    <label for="form-title"
                           (click)="formsettingsmodal.scrollToFooter()"
                           (keydown.enter)="formsettingsmodal.scrollToFooter()"
                           role="button"
                           tabindex="0"
                           i18n>Formular Titel *</label>
                    <power-forms-editor-localeinput [(locale)]="model.title"
                                                    eid="form-title"
                                                    [required]="true"
                                                    [maxlength]="200"
                                                    i18n-placeholder
                                                    placeholder="Formular Titel"></power-forms-editor-localeinput>
                </div>

                <!-- form-showTitle -->
                <div class="custom-control custom-checkbox mb-3">
                    <input type="checkbox"
                           class="custom-control-input"
                           [(ngModel)]="model.showTitle"
                           name="form-showTitle"
                           id="form-showTitle">
                    <label class="custom-control-label"
                           for="form-showTitle"
                           i18n>Titel anzeigen</label>
                </div>

                <!-- form-description -->
                <div class="form-group">
                    <label for="form-description"
                           i18n>Formular Beschreibung</label>
                    <power-forms-editor-localeinput [textarea]="true"
                                                    [(locale)]="model.description"
                                                    eid="form-description"
                                                    describedby="form-descriptionHelp"></power-forms-editor-localeinput>
                    <small id="form-descriptionHelp"
                           class="form-text text-muted"
                           i18n>Dieser Text wird auf jeder Seite vom Formular angezeigt werden.</small>
                </div>

                <!-- markdown-instructions -->
                <power-markdown-instructions #formattinghelpmodal>
                </power-markdown-instructions>

                <!-- form-locale-->
                <div class="form-group">
                    <label for="form-locale"
                           i18n>Standardsprache</label>
                    <select class="custom-select text-capitalize"
                            [(ngModel)]="model.locale"
                            id="form-locale"
                            name="form-locale"
                            aria-describedby="form-localeHelp">
                        <option *ngFor="let lang of languages | keyvalue; index as i"
                                [ngValue]="lang.key"
                                [lang]="lang.key">
                            {{ lang.value }}
                        </option>
                    </select>
                    <small id="form-localeHelp"
                           class="form-text text-muted"
                           i18n>Die Standardsprache, welche der nutzenden Person angezeigt wird. Die nutzende Person hat
                        die Möglichkeit die Sprache zu wechseln.</small>
                </div>

                <!-- form-showQuestionNumbers-->
                <div class="form-group">
                    <label for="form-showQuestionNumbers"
                           i18n>Fragen Nummerierung</label>
                    <select class="custom-select"
                            [(ngModel)]="model.showQuestionNumbers"
                            id="form-showQuestionNumbers"
                            name="form-showQuestionNumbers">
                        <option value="on"
                                i18n>Durchgängig nummerieren</option>
                        <option value="onpage"
                                i18n>Seitenweise nummerieren</option>
                        <option value="off"
                                i18n>Keine Nummern anzeigen</option>
                    </select>
                </div>

                <!-- form-questionsOrder-->
                <div class="form-group">
                    <label for="form-questionsOrder"
                           i18n>Fragen Reihenfolge</label>
                    <select class="custom-select"
                            [(ngModel)]="model.questionsOrder"
                            id="form-questionsOrder"
                            name="form-questionsOrder">
                        <option value="initial"
                                i18n>Wie definiert</option>
                        <option value="random"
                                i18n>Zufällig</option>
                    </select>
                </div>

                <!-- form-completedHtml -->
                <div class="form-group">
                    <label for="form-completedHtml"
                           role="button"
                           i18n>Abschlusstext</label>
                    <power-forms-editor-localeinput [textarea]="true"
                                                    [(locale)]="model.completedHtml"
                                                    eid="form-completedHtml"></power-forms-editor-localeinput>
                </div>

                <!-- form-navigateToUrl -->
                <div class="form-group">
                    <label for="form-navigateToUrl"
                           i18n>Umleitungs URL</label>
                    <input type="text"
                           class="form-control"
                           [(ngModel)]="model.navigateToUrl"
                           name="form-navigateToUrl"
                           id="form-navigateToUrl"
                           i18n-placeholder
                           placeholder="https://..."
                           aria-describedby="form-navigateToUrlHelp"
                           autocomplete="off">
                    <small id="form-navigateToUrlHelp"
                           class="form-text text-muted"
                           i18n>Die nutzenden Person wird nach Abschluss des Formulars an diese Adresse
                        weitergeleitet.</small>
                </div>
            </accordion-group>

            <!-- logo -->
            <accordion-group i18n-heading
                             heading="Logo"
                             class="mb-1 mb-lg-3">
                <!-- form-logo -->
                <div class="form-group">
                    <label for="form-logo"
                           i18n>Formular Logo</label>
                    <input type="text"
                           class="form-control"
                           [(ngModel)]="model.logo"
                           name="form-logo"
                           id="form-logo"
                           i18n-placeholder
                           placeholder="https://..."
                           aria-describedby="form-logoHelp"
                           autocomplete="off">
                    <small id="form-logoHelp"
                           class="form-text text-muted"
                           i18n>Eine URL zu einem Logo angeben.</small>
                </div>

                <!-- form-logoPosition -->
                <div class="form-group">
                    <label for="form-logoPosition"
                           i18n>Position</label>
                    <select class="custom-select"
                            [(ngModel)]="model.logoPosition"
                            id="form-logoPosition"
                            name="form-logoPosition">
                        <option value="none"
                                i18n>Nicht anzeigen</option>
                        <option value="left"
                                i18n>Links</option>
                        <option value="right"
                                i18n>Rechts</option>
                        <option value="top"
                                i18n>Oben</option>
                        <option value="bottom"
                                i18n>Unten</option>
                    </select>
                </div>

                <!-- form-logoWidth -->
                <div class="form-group">
                    <label for="form-logoWidth"
                           i18n>Breite in Pixel</label>
                    <input type="number"
                           class="form-control"
                           [(ngModel)]="model.logoWidth"
                           [class.is-invalid]="!!model.logoWidth && (model.logoWidth % 1 !== 0 || model.logoWidth < 16 || model.logoWidth > 512)"
                           step="1"
                           min="16"
                           max="512"
                           name="form-logoWidth"
                           id="form-logoWidth">
                </div>

                <!-- form-logoHeight -->
                <div class="form-group">
                    <label for="form-logoHeight"
                           i18n>Höhe in Pixel</label>
                    <input type="number"
                           class="form-control"
                           [(ngModel)]="model.logoHeight"
                           [class.is-invalid]="!!model.logoHeight && (model.logoHeight % 1 !== 0 || model.logoHeight < 16 || model.logoHeight > 512)"
                           step="1"
                           min="16"
                           max="512"
                           name="form-logoHeight"
                           id="form-logoHeight">
                </div>

                <!-- form-logoFit-->
                <div class="form-group">
                    <label for="form-logoFit"
                           i18n>Größenanpassung</label>
                    <select class="custom-select"
                            [(ngModel)]="model.logoFit"
                            id="form-logoFit"
                            name="form-logoFit">
                        <option value="none"
                                i18n>Keine Anpassung</option>
                        <option value="contain"
                                i18n>Verkleinern</option>
                        <option value="cover"
                                i18n>Abschneiden</option>
                        <option value="fill"
                                i18n>Füllen</option>
                    </select>
                </div>
            </accordion-group>

            <!-- navigation -->
            <accordion-group i18n-heading
                             heading="Navigation"
                             class="mb-1 mb-lg-3">
                <!-- form-firstPageIsStarted -->
                <div class="custom-control custom-checkbox mb-3">
                    <input type="checkbox"
                           class="custom-control-input"
                           [(ngModel)]="model.firstPageIsStarted"
                           name="form-firstPageIsStarted"
                           id="form-firstPageIsStarted"
                           aria-describedby="form-firstPageIsStartedHelp">
                    <label class="custom-control-label"
                           for="form-firstPageIsStarted"
                           i18n>Erste Seite ist Startseite</label>
                    <small id="form-firstPageIsStartedHelp"
                           class="form-text text-muted"
                           i18n>Die erste Seite erhält einen Start Button für das Formular.</small>
                </div>

                <!-- form-showPrevButton -->
                <div class="custom-control custom-checkbox mb-3">
                    <input type="checkbox"
                           class="custom-control-input"
                           [(ngModel)]="model.showPrevButton"
                           name="form-showPrevButton"
                           id="form-showPrevButton">
                    <label class="custom-control-label"
                           for="form-showPrevButton"
                           i18n>Zurück Button erlauben</label>
                </div>

                <!-- form-goNextPageAutomatic -->
                <div class="custom-control custom-checkbox mb-3">
                    <input type="checkbox"
                           class="custom-control-input"
                           [(ngModel)]="model.goNextPageAutomatic"
                           name="form-goNextPageAutomatic"
                           id="form-goNextPageAutomatic"
                           aria-describedby="form-goNextPageAutomaticHelp">
                    <label class="custom-control-label"
                           for="form-goNextPageAutomatic"
                           i18n>Nächste Seite automatisch öffnen</label>
                    <small id="form-goNextPageAutomaticHelp"
                           class="form-text text-muted"
                           i18n>Nach abschließen einer Seite wird automatisch die nächste geöffnet.</small>
                </div>

                <!-- form-showPreviewBeforeComplete-->
                <div class="form-group">
                    <label for="form-showPreviewBeforeComplete"
                           i18n>Vorschau vor dem absenden</label>
                    <select class="custom-select"
                            [(ngModel)]="model.showPreviewBeforeComplete"
                            id="form-showPreviewBeforeComplete"
                            name="form-showPreviewBeforeComplete"
                            aria-describedby="form-showPreviewBeforeCompleteHelp">
                        <option value="noPreview"
                                i18n>Keine Vorschau</option>
                        <option value="showAllQuestions"
                                i18n>Alle Fragen</option>
                        <option value="showAnsweredQuestions"
                                i18n>Alle ausgefüllten Fragen</option>
                    </select>
                    <small id="form-showPreviewBeforeCompleteHelp"
                           class="form-text text-muted"
                           i18n>Der nutzenden Person kann eine Vorschau der Antworten angezeigt werden, bevor das
                        Formular final absendet wird.</small>
                </div>

                <!-- form-showProgressBar-->
                <div class="form-group">
                    <label for="form-showProgressBar"
                           i18n>Fortschrittsbalken Anzeigen</label>
                    <select class="custom-select"
                            [(ngModel)]="model.showProgressBar"
                            id="form-showProgressBar"
                            name="form-showProgressBar">
                        <option value="off"
                                i18n>Nicht anzeigen</option>
                        <option value="top"
                                i18n>Oben</option>
                        <option value="bottom"
                                i18n>Unten</option>
                        <option value="both"
                                i18n>Oben und unten</option>
                    </select>
                </div>

                <!-- form-progressBarType-->
                <div class="form-group">
                    <label for="form-progressBarType"
                           i18n>Fortschrittsbalken Berechnung</label>
                    <select class="custom-select"
                            [(ngModel)]="model.progressBarType"
                            id="form-progressBarType"
                            name="form-progressBarType">
                        <option value="pages"
                                i18n>Sichtbare Seiten</option>
                        <option value="requiredQuestions"
                                i18n>Sichtbare Pflichtfragen</option>
                        <option value="questions"
                                i18n>Alle sichtbaren Fragen</option>
                        <option value="correctQuestions"
                                i18n>Korrekt beantwortete Fragen (Quiz)</option>
                    </select>
                </div>
            </accordion-group>

            <!-- pages -->
            <accordion-group i18n-heading
                             heading="Seiten"
                             class="mb-1 mb-lg-3">
                <!-- render pages -->
                <accordion [isAnimated]="false"
                           [closeOthers]="true">
                    <accordion-group *ngFor="let page of model.pages; index as i"
                                     class="mb-1 mb-lg-3">
                        <!-- card head -->
                        <div accordion-heading
                             (keyup.enter)="openPage()"
                             class="btn btn-link btn-block p-0 clearfix clickable"
                             role="button"
                             tabindex="0">
                            <span class="pull-left float-left">
                                <span i18n>Seite</span> {{ i + 1 }}</span>
                            <span class="float-right pull-right"
                                  (click)="$event.stopPropagation()"
                                  (keydown.enter)="$event.stopPropagation()">
                                <button type="button"
                                        class="btn btn-sm btn-light mr-2"
                                        i18n-title
                                        title="Nach oben verschieben"
                                        (click)="moveUp(i)"
                                        [disabled]="i === 0">
                                    <svg width="1em"
                                         height="1em"
                                         viewBox="0 0 16 16"
                                         class="bi bi-caret-up"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg"
                                         role="img"
                                         focusable="false"
                                         aria-hidden="true">
                                        <path fill-rule="evenodd"
                                              d="M3.204 11L8 5.519 12.796 11H3.204zm-.753-.659l4.796-5.48a1 1 0 0 1 1.506 0l4.796 5.48c.566.647.106 1.659-.753 1.659H3.204a1 1 0 0 1-.753-1.659z" />
                                    </svg>
                                    <span class="sr-only"
                                          i18n>Nach oben verschieben</span>
                                </button>

                                <button type="button"
                                        class="btn btn-sm btn-light"
                                        i18n-title
                                        title="Nach unten verschieben"
                                        (click)="moveDown(i)"
                                        [disabled]="i === model.pages.length - 1">
                                    <svg width="1em"
                                         height="1em"
                                         viewBox="0 0 16 16"
                                         class="bi bi-caret-down"
                                         fill="currentColor"
                                         xmlns="http://www.w3.org/2000/svg"
                                         role="img"
                                         focusable="false"
                                         aria-hidden="true">
                                        <path fill-rule="evenodd"
                                              d="M3.204 5L8 10.481 12.796 5H3.204zm-.753.659l4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659z" />
                                    </svg>
                                    <span class="sr-only"
                                          i18n>Nach unten verschieben</span>
                                </button>
                            </span>
                        </div>

                        <!-- page-title -->
                        <div class="form-group">
                            <label for="page-title-{{ i }}"
                                   i18n>Seiten Titel</label>
                            <power-forms-editor-localeinput [(locale)]="page.title"
                                                            eid="page-title-{{ i }}"
                                                            [maxlength]="200"
                                                            i18n-placeholder
                                                            placeholder="Seiten Titel">
                            </power-forms-editor-localeinput>
                        </div>

                        <!-- page-description -->
                        <div class="form-group">
                            <label for="page-description-{{ i }}"
                                   i18n>Seiten Beschreibung</label>
                            <power-forms-editor-localeinput [textarea]="true"
                                                            [(locale)]="page.description"
                                                            eid="page-description-{{ i }}">
                            </power-forms-editor-localeinput>
                        </div>

                        <!-- markdown-instructions -->
                        <power-markdown-instructions #formattinghelpmodal>
                        </power-markdown-instructions>


                        <!-- page-questionsOrder-->
                        <div class="form-group">
                            <label for="page-questionsOrder-{{ i }}"
                                   i18n>Fragen Reihenfolge</label>
                            <!-- [html-validate-disable-next input-missing-label] -->
                            <select class="custom-select"
                                    [(ngModel)]="page.questionsOrder"
                                    id="page-questionsOrder-{{ i }}"
                                    name="page-questionsOrder-{{ i }}"
                                    attr.aria-describedby="page-questionsOrderHelp-{{ i }}">
                                <option value="default"
                                        i18n>Standard</option>
                                <option value="initial"
                                        i18n>Wie definiert</option>
                                <option value="random"
                                        i18n>Zufällig</option>
                            </select>
                            <small id="page-questionsOrderHelp-{{ i }}"
                                   class="form-text text-muted"
                                   i18n>Diese Option überschreibt den Standardwert aus dem Reiter Allgemein.</small>
                        </div>

                        <!-- page-visible -->
                        <div class="custom-control custom-checkbox mb-3">
                            <!-- [html-validate-disable-next input-missing-label] -->
                            <input type="checkbox"
                                   class="custom-control-input"
                                   [(ngModel)]="page.visible"
                                   name="page-visible-{{ i }}"
                                   id="page-visible-{{ i }}"
                                   attr.aria-describedby="page-visibleHelp-{{ i }}">
                            <label class="custom-control-label"
                                   for="page-visible-{{ i }}"
                                   i18n>Sichtbar</label>
                            <small id="page-visibleHelp-{{ i }}"
                                   class="form-text text-muted"
                                   i18n>Diese Option stellt ein, ob die Seite standardmäßig sichtbar ist.</small>
                        </div>

                        <!-- page-readOnly -->
                        <div class="custom-control custom-checkbox mb-3">
                            <!-- [html-validate-disable-next input-missing-label] -->
                            <input type="checkbox"
                                   class="custom-control-input"
                                   [(ngModel)]="page.readOnly"
                                   name="page-readOnly-{{ i }}"
                                   id="page-readOnly-{{ i }}"
                                   attr.aria-describedby="page-readOnlyHelp-{{ i }}">
                            <label class="custom-control-label"
                                   for="page-readOnly-{{ i }}"
                                   i18n>Deaktiviert</label>
                            <small id="page-readOnlyHelp-{{ i }}"
                                   class="form-text text-muted"
                                   i18n>Diese Option stellt ein, ob die Seite standardmäßig ausfüllbar ist.</small>
                        </div>

                        <!-- page-maxTimeToFinish -->
                        <div class="form-group">
                            <label for="page-maxTimeToFinish-{{ i }}"
                                   i18n>Zeitlimit in Sekunden für die Seite</label>
                            <!-- [html-validate-disable-next input-missing-label] -->
                            <input type="number"
                                   class="form-control"
                                   [(ngModel)]="page.maxTimeToFinish"
                                   [class.is-invalid]="!!page.maxTimeToFinish && (page.maxTimeToFinish % 1 !== 0 || page.maxTimeToFinish < 0)"
                                   step="1"
                                   min="0"
                                   name="page-maxTimeToFinish-{{ i }}"
                                   id="page-maxTimeToFinish-{{ i }}"
                                   attr.aria-describedby="page-maxTimeToFinishHelp-{{ i }}">
                            <small id="page-maxTimeToFinishHelp-{{ i }}"
                                   class="form-text text-muted"
                                   i18n>Diese Option überschreibt den Standardwert pro Seite aus dem Reiter
                                Timer/Quiz. Der Wert 0 deaktiviert das Zeitlimit.</small>
                        </div>

                        <hr>
                        <span i18n>Sichtbarkeitsbedingung</span>
                        <hr>
                        <power-forms-editor-conditions [model]="model"
                                                       [(data)]="page.visibleIf">
                        </power-forms-editor-conditions>

                        <hr>
                        <span i18n>Aktivierungsbedingung</span>
                        <hr>
                        <power-forms-editor-conditions [model]="model"
                                                       [(data)]="page.enableIf">
                        </power-forms-editor-conditions>
                    </accordion-group>
                </accordion>
            </accordion-group>

            <!-- timer/quiz -->
            <accordion-group i18n-heading
                             heading="Timer/Quiz"
                             class="mb-1 mb-lg-3">
                <!-- form-maxTimeToFinish -->
                <div class="form-group">
                    <label for="form-maxTimeToFinish"
                           i18n>Zeitlimit in Sekunden für das Formular</label>
                    <input type="number"
                           class="form-control"
                           [(ngModel)]="model.maxTimeToFinish"
                           [class.is-invalid]="!!model.maxTimeToFinish && (model.maxTimeToFinish % 1 !== 0 || model.maxTimeToFinish < 0)"
                           step="1"
                           min="0"
                           name="form-maxTimeToFinish"
                           id="form-maxTimeToFinish">
                </div>

                <!-- form-maxTimeToFinishPage -->
                <div class="form-group">
                    <label for="form-maxTimeToFinishPage"
                           i18n>Zeitlimit in Sekunden pro Seite</label>
                    <input type="number"
                           class="form-control"
                           [(ngModel)]="model.maxTimeToFinishPage"
                           [class.is-invalid]="!!model.maxTimeToFinishPage && (model.maxTimeToFinishPage % 1 !== 0 || model.maxTimeToFinishPage < 0)"
                           step="1"
                           min="0"
                           name="form-maxTimeToFinishPage"
                           id="form-maxTimeToFinishPage">
                </div>

                <!-- form-showTimerPanel-->
                <div class="form-group">
                    <label for="form-showTimerPanel"
                           i18n>Zeitlimit anzeigen</label>
                    <select class="custom-select"
                            [(ngModel)]="model.showTimerPanel"
                            id="form-showTimerPanel"
                            name="form-showTimerPanel">
                        <option value="none"
                                i18n>Nicht anzeigen</option>
                        <option value="top"
                                i18n>Oben</option>
                        <option value="bottom"
                                i18n>Unten</option>
                    </select>
                </div>

                <!-- form-showTimerPanelMode-->
                <div class="form-group">
                    <label for="form-showTimerPanelMode"
                           i18n>Timer anzeigen</label>
                    <select class="custom-select"
                            [(ngModel)]="model.showTimerPanelMode"
                            id="form-showTimerPanelMode"
                            name="form-showTimerPanelMode">
                        <option value="all"
                                i18n>Zeit auf dieser Seite und das gesamte Formular</option>
                        <option value="page"
                                i18n>Zeit auf dieser Seite</option>
                        <option value="survey"
                                i18n>Zeit für das gesamte Formular</option>
                    </select>
                </div>
            </accordion-group>
        </accordion>

        <hr>
        <button type="button"
                class="btn btn-success mr-2"
                i18n-title
                title="Änderungen speichern"
                (click)="modal?.close()">
            <svg width="1em"
                 height="1em"
                 viewBox="0 0 16 16"
                 class="bi bi-hdd"
                 fill="currentColor"
                 xmlns="http://www.w3.org/2000/svg"
                 role="img"
                 focusable="false"
                 aria-hidden="true">
                <path fill-rule="evenodd"
                      d="M14 9H2a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1zM2 8a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2H2z" />
                <path d="M5 10.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm-2 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z" />
                <path fill-rule="evenodd"
                      d="M4.094 4a.5.5 0 0 0-.44.26l-2.47 4.532A1.5 1.5 0 0 0 1 9.51v.99H0v-.99c0-.418.105-.83.305-1.197l2.472-4.531A1.5 1.5 0 0 1 4.094 3h7.812a1.5 1.5 0 0 1 1.317.782l2.472 4.53c.2.368.305.78.305 1.198v.99h-1v-.99a1.5 1.5 0 0 0-.183-.718L12.345 4.26a.5.5 0 0 0-.439-.26H4.094z" />
            </svg>
            <span class="ml-1"
                  i18n>Änderungen speichern</span>
        </button>
    </div>
</power-modal>
