<div class="container my-4"
     *ngIf="configService.config.modules.includes('bodenrichtwerte-altsystem') && showPrintNotice">
    <alert type="info"
           role="alert">
        <button i18n-aria-label
                aria-label="Schließen"
                i18n-title
                title="Schließen"
                class="close ng-star-inserted"
                type="button"
                (click)="showPrintNotice = false;">
            <span aria-hidden="true">×</span>
            <span class="sr-only"
                  i18n>Alert schließen</span>
        </button>
        <span class="h4 alert-heading">
            <svg width="1em"
                 height="1em"
                 viewBox="0 0 16 16"
                 class="bi bi-info-circle"
                 fill="currentColor"
                 xmlns="http://www.w3.org/2000/svg"
                 focusable="false"
                 aria-hidden="true">
                <path fill-rule="evenodd"
                      d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path
                      d="M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588z" />
                <circle cx="8"
                        cy="4.5"
                        r="1" />
            </svg>
            <span class="ml-2"
                  i18n>Bodenrichtwerte - amtlicher Ausdruck</span>
        </span>
        <p class="m-0">Die amtliche Druckfunktion und Bodenrichtwerte von vor 2012 erhalten Sie beim Gutachterausschuss.
            Ein Benutzeraccount ist hierfür erforderlich.</p>
        <a href="https://www.boris.niedersachsen.de/boris/login"
           target="_blank"
           rel="noopener noreferrer nofollow">
            <svg width="1em"
                 height="1em"
                 viewBox="0 0 16 16"
                 class="bi bi-box-arrow-right"
                 fill="currentColor"
                 xmlns="http://www.w3.org/2000/svg"
                 focusable="false"
                 aria-hidden="true">
                <path fill-rule="evenodd"
                      d="M11.646 11.354a.5.5 0 0 1 0-.708L14.293 8l-2.647-2.646a.5.5 0 0 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0z" />
                <path fill-rule="evenodd"
                      d="M4.5 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5z" />
                <path fill-rule="evenodd"
                      d="M2 13.5A1.5 1.5 0 0 1 .5 12V4A1.5 1.5 0 0 1 2 2.5h7A1.5 1.5 0 0 1 10.5 4v1.5a.5.5 0 0 1-1 0V4a.5.5 0 0 0-.5-.5H2a.5.5 0 0 0-.5.5v8a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-1.5a.5.5 0 0 1 1 0V12A1.5 1.5 0 0 1 9 13.5H2z" />
            </svg>
            <span class="ml-1"
                  i18n>Zu BORIS.NI wechseln</span>
        </a>
    </alert>
</div>

<div class="container-fluid p-0 m-0">
    <div class="row m-0">
        <div id="mapWrapper"
             class="border-bottom"
             [class]="!adresse && !features ? 'col-sm-36 map-default' : isCollapsed ? 'col-lg-35 col-md-36 map-collapsed' : 'col-lg-17 map'">
            <power-bodenrichtwertkarte #map
                                       [(isCollapsed)]="isCollapsed"
                                       [collapsed]="collapsed"
                                       [expanded]="expanded"
                                       [(adresse)]="adresse"
                                       [(features)]="features"
                                       [(stichtag)]="stichtag"
                                       [(teilmarkt)]="teilmarkt"
                                       [(flurstueck)]="flurstueck"></power-bodenrichtwertkarte>
        </div>
        <button *ngIf="adresse || features"
                class="col-lg-1 btn d-none d-lg-block d-xxl-block p-0 border-left border-bottom"
                type="button"
                title="Detailansicht ein- bzw. ausklappen"
                i18n-title
                (click)="isCollapsed = !isCollapsed"
                [attr.aria-expanded]="!isCollapsed"
                aria-controls="collapseBasic">
            <img src="{{ isCollapsed ? '/assets/icons/chevron-left.svg' : '/assets/icons/chevron-right.svg'}}"
                 alt="Einklappen/ausklappen"
                 class="h-100 w-100"
                 i18n-alt>
        </button>
        <div [class]="isCollapsed ? 'col-36 border-top' : 'col-lg-18 border-bottom'">
            <div class="row border-bottom">
                <!-- Case 1 -->
                <div *ngIf="!adresse && !features"
                     class="text-center p-0 address-header"
                     [class]="isCollapsed ? 'col-36' : 'col-36 col-sm-30'">
                    <h5 class="m-3 mx-center"
                        i18n>Wählen Sie eine Position</h5>
                </div>
                <button *ngIf="adresse || features"
                        class="btn d-lg-none d-xxl-none col-md-2 m-0 p-0"
                        type="button"
                        title="Detailansicht ein- bzw. ausklappen"
                        i18n-title
                        (click)="isCollapsed = !isCollapsed"
                        [attr.aria-expanded]="!isCollapsed"
                        aria-controls="collapseBasic">
                    <img src="{{ isCollapsed ? '/assets/icons/chevron-up.svg' : '/assets/icons/chevron-down.svg'}}"
                         width="80"
                         height="25"
                         alt="Einklappen/ausklappen"
                         i18n-alt>
                </button>
                <!-- Case 2 -->
                <button *ngIf="!adresse && features && features.features.length"
                        class="btn p-0 address-header"
                        [class]="isCollapsed ? 'd-lg-none d-xxl-none col-34' : 'col-lg-30 col-md-28 col-sm-32 col-36'"
                        type="button"
                        (click)="isCollapsed = !isCollapsed"
                        [attr.aria-expanded]="!isCollapsed"
                        aria-controls="collapseBasic">{{ features.features[0].properties.brzname}}
                    <span *ngIf="flurstueck && flurstueck?.features.length"
                          [class.d-none]="isCollapsed"
                          class="row justify-content-center mb-0"
                          type="text">
                        <span class="col">
                            <small i18n>Flurstückskennzeichen</small>
                            <svg class="mr-4"
                                 fill-rule="evenodd"
                                 viewBox="0 0 20 22"
                                 width="24"
                                 height="20"
                                 focusable="false"
                                 aria-hidden="true">
                                <g transform="translate(-10,-20) scale(0.5,0.4)">
                                    <path fill="none"
                                          stroke="#96999e"
                                          d="M 27.237147,57.888549 51.106583,52.026518 66.420364,96.500039 40.933018,96.903113 Z" />
                                </g>
                            </svg>
                            <span class="flurstueck">
                                <span *ngIf="flurstueck.features[0]?.properties.gemarkungsnummer">
                                    <small class="ml-2 mr-2"
                                           i18n>Gemarkung:
                                        {{ flurstueck.features[0].properties.gemarkungsnummer }}
                                    </small>
                                </span>
                                <span *ngIf="flurstueck.features[0]?.properties.flurnummer">
                                    <small class="mr-2"
                                           i18n>Flurnummer:
                                        {{ flurstueck.features[0].properties.flurnummer }}
                                    </small>
                                </span>
                                <span *ngIf="flurstueck.features[0]?.properties.zaehler">
                                    <small i18n>Flurstück:
                                        {{ flurstueck.features[0].properties.zaehler }}</small>
                                    <small *ngIf="flurstueck.features[0]?.properties.nenner">/{{
                                        flurstueck.features[0].properties.nenner }}
                                    </small>
                                </span>
                            </span>
                        </span>
                    </span>
                </button>
                <!-- Case 3 -->
                <div *ngIf="!adresse && features && !features.features.length"
                     type="text"
                     class="w-100 address-header address-header-c3"
                     [class]="isCollapsed ? 'col-34' : 'col-lg-30 col-md-28 col-sm-32 col-32'">
                    <h5 class="m-3 mx-center text-center"
                        i18n>Wählen Sie eine Position</h5>
                </div>
                <!-- Case 4 -->
                <button *ngIf="adresse"
                        class="btn p-0 address-header"
                        [class]="isCollapsed ? 'd-lg-none d-xxl-none col-34' : 'col-lg-30 col-md-28 col-sm-32 col-36'"
                        (click)="isCollapsed = !isCollapsed"
                        [attr.aria-expanded]="!isCollapsed"
                        aria-controls="collapseBasic"
                        type="button">{{ adresse.properties.text }}
                    <span *ngIf="flurstueck && flurstueck?.features.length"
                          [class.d-none]="isCollapsed"
                          class="row justify-content-center mb-0"
                          type="text">
                        <span class="col">
                            <small i18n>Flurstückskennzeichen</small>
                            <svg class="mr-4"
                                 fill-rule="evenodd"
                                 viewBox="0 0 20 22"
                                 width="24"
                                 height="20"
                                 focusable="false"
                                 aria-hidden="true">
                                <g transform="translate(-10,-20) scale(0.5,0.4)">
                                    <path fill="none"
                                          stroke="#96999e"
                                          d="M 27.237147,57.888549 51.106583,52.026518 66.420364,96.500039 40.933018,96.903113 Z" />
                                </g>
                            </svg>
                            <span class="flurstueck">
                                <span *ngIf="flurstueck.features[0]?.properties.gemarkungsnummer">
                                    <small class="ml-2 mr-2"
                                           i18n>Gemarkung:
                                        {{ flurstueck.features[0].properties.gemarkungsnummer }}
                                    </small>
                                </span>
                                <span *ngIf="flurstueck.features[0]?.properties.flurnummer">
                                    <small class="mr-2"
                                           i18n>Flurnummer:
                                        {{ flurstueck.features[0].properties.flurnummer }}
                                    </small>
                                </span>
                                <span *ngIf="flurstueck.features[0]?.properties.zaehler">
                                    <small i18n>Flurstück:
                                        {{ flurstueck.features[0].properties.zaehler }}</small>
                                    <small *ngIf="flurstueck.features[0]?.properties.nenner">/{{
                                        flurstueck.features[0].properties.nenner }}
                                    </small>
                                </span>
                            </span>
                        </span>
                    </span>
                </button>
                <div *ngIf="!isCollapsed"
                     class="col-md-6 col-sm-4 col-36 p-0 d-flex justify-content-end">
                    <a *ngIf="features?.features.length && checkIfStichtagFtsExist()"
                       class="nav-link btn p-1 align-self-center"
                       role="button"
                       [href]="printURL()"
                       target="_blank"
                       rel="noopener noreferrer nofollow"
                       alt="Bodenrichtwerte - amtlicher Ausdruck"
                       title="Bodenrichtwerte - amtlicher Ausdruck"
                       i18n-title>
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="20px"
                             height="20px"
                             fill="currentColor"
                             class="bi bi-printer"
                             viewBox="0 0 16 16"
                             focusable="false"
                             aria-hidden="true">
                            <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z" />
                            <path
                                  d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z" />
                        </svg>
                        <span class="d-none"
                              aria-hidden="true">Bodenrichtwerte - amtlicher Ausdruck </span>
                    </a>
                    <button [disabled]="!adresse && !features.features.length"
                            class="nav-link btn py-1 px-3 align-self-center"
                            [ngClass]="{'active': hintsActive}"
                            type="button"
                            alt="Hinweise zur aktuellen Darstellung"
                            title="Hinweise zur aktuellen Darstellung"
                            (click)="hintsActive = !hintsActive"
                            i18n-alt
                            i18n-title>
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="20px"
                             height="20px"
                             fill="currentColor"
                             class="bi bi-info-circle"
                             viewBox="0 0 16 16"
                             focusable="false"
                             aria-hidden="true">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                            <path
                                  d="M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="row overflow-auto"
                 [class]="isCollapsed ? '' : 'details'">
                <div #collapse
                     id="collapseBasic"
                     class="p-0 col-36"
                     [collapse]="isCollapsed"
                     (collapsed)="onCollapsingEnds()"
                     (expanded)="onExpandingEnds()"
                     [isAnimated]="true">
                    <div class="well well-lg card card-block card-header verlauf p-1 p-sm-2 p-md-3">
                        <div class="p-0"
                             *ngIf="features">
                            <div *ngIf="(!adresse || adresse.properties.bundesland != 'Niedersachsen' || adresse.properties.bundesland != 'Bremen') && !features.features.length"
                                 class="text-center col-36">
                                <p class="m-3 mx-center lead"
                                   i18n>Keine gültige Adresse!</p>
                                <p class="m-3 mx-center lead"
                                   i18n>Hinweis:</p>
                                <p class="m-3 mx-center"
                                   i18n>Bitte wählen Sie eine gültige Adresse innerhalb von Niedersachsen oder
                                    Bremen
                                    aus.
                                    Die Genauigkeit des Suchradius für die Adresse beträgt 50 Meter.</p>
                            </div>
                            <div [class]="hintsActive ? 'd-block' : 'd-none'">
                                <div *ngIf="adresse || features.features.length"
                                     class="col-36 text-center">
                                    <p class="m-3 mx-center"
                                       i18n>Aufgrund von unterschiedlichen Aktualisierungsintervallen können die
                                        Suchergebnisse
                                        von der Kartendarstellung abweichen.</p>
                                </div>
                                <div *ngIf="flurstueck"
                                     class="text-center col-36">
                                    <p class="m-3 mx-center"
                                       i18n>Die aufgeführten Informationen zum Flurstück beziehen sich lediglich auf den
                                        aktuell ausgewählten Standort und auf den Stichtag {{ getStichtag() | date }}.
                                    </p>
                                </div>
                                <div *ngIf="adresse && (adresse.properties.bundesland == 'Niedersachsen' || adresse.properties.bundesland == 'Bremen') && !features.features.length"
                                     class="text-center col-36">
                                    <p class="m-3 mx-center"
                                       i18n>Es liegen keine Bodenrichtwertdaten für diese Adresse vor.</p>
                                </div>
                                <div *ngIf="!adresse && features.features.length"
                                     class="text-center col-36">
                                    <p class="m-3 mx-center"
                                       i18n>Es liegen Bodenrichtwertdaten für diese Koordinate vor. Jedoch konnte keine
                                        Adresse für diesen Standort gefunden werden.</p>
                                    <p class="m-3 mx-center"
                                       i18n>Die Genauigkeit des Suchradius für die Adresse beträgt 50 Meter.</p>
                                </div>
                            </div>

                            <power-bodenrichtwert-liste [stichtag]="stichtag"
                                                        [teilmarkt]="teilmarkt"
                                                        [features]="features">
                            </power-bodenrichtwert-liste>
                        </div>
                        <div class="p-0"
                             [class.d-none]="!features">
                            <power-bodenrichtwert-verlauf class="col-md-36 p-0"
                                                          [features]="features"></power-bodenrichtwert-verlauf>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
